import{c as createContext}from"./createContext.C6fsTd1r.js";import{u as useDirection}from"./useDirection.BL8aHuFH.js";import{P as Primitive}from"./Primitive.DurlyzDV.js";import{u as useCollection}from"./Collection.Of9eBc3j.js";import{g as getActiveElement}from"./getActiveElement.C3iuMN-h.js";import{b as useVModel}from"./useForwardExpose.Ct4MH066.js";import{d as defineComponent,q as toRefs,h as ref,e as createBlock,o as openBlock,w as withCtx,f as createVNode,u as unref,l as renderSlot}from"./runtime-core.esm-bundler.T-J3b-OY.js";const ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",EVENT_OPTIONS={bubbles:!1,cancelable:!0},MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function getDirectionAwareKey(key,dir){return dir!=="rtl"?key:key==="ArrowLeft"?"ArrowRight":key==="ArrowRight"?"ArrowLeft":key}function getFocusIntent(event,orientation,dir){const key=getDirectionAwareKey(event.key,dir);if(!(orientation==="vertical"&&["ArrowLeft","ArrowRight"].includes(key))&&!(orientation==="horizontal"&&["ArrowUp","ArrowDown"].includes(key)))return MAP_KEY_TO_FOCUS_INTENT[key]}function focusFirst(candidates,preventScroll=!1){const PREVIOUSLY_FOCUSED_ELEMENT=getActiveElement();for(const candidate of candidates)if(candidate===PREVIOUSLY_FOCUSED_ELEMENT||(candidate.focus({preventScroll}),getActiveElement()!==PREVIOUSLY_FOCUSED_ELEMENT))return}function wrapArray(array,startIndex){return array.map((_,index)=>array[(startIndex+index)%array.length])}const[injectRovingFocusGroupContext,provideRovingFocusGroupContext]=createContext("RovingFocusGroup");var RovingFocusGroup_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"RovingFocusGroup",props:{orientation:{type:String,required:!1,default:void 0},dir:{type:String,required:!1},loop:{type:Boolean,required:!1,default:!1},currentTabStopId:{type:[String,null],required:!1},defaultCurrentTabStopId:{type:String,required:!1},preventScrollOnEntryFocus:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["entryFocus","update:currentTabStopId"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emits=__emit,{loop,orientation,dir:propDir}=toRefs(props),dir=useDirection(propDir),currentTabStopId=useVModel(props,"currentTabStopId",emits,{defaultValue:props.defaultCurrentTabStopId,passive:props.currentTabStopId===void 0}),isTabbingBackOut=ref(!1),isClickFocus=ref(!1),focusableItemsCount=ref(0),{getItems,CollectionSlot}=useCollection({isProvider:!0});function handleFocus(event){const isKeyboardFocus=!isClickFocus.value;if(event.currentTarget&&event.target===event.currentTarget&&isKeyboardFocus&&!isTabbingBackOut.value){const entryFocusEvent=new CustomEvent(ENTRY_FOCUS,EVENT_OPTIONS);if(event.currentTarget.dispatchEvent(entryFocusEvent),emits("entryFocus",entryFocusEvent),!entryFocusEvent.defaultPrevented){const items=getItems().map(i=>i.ref).filter(i=>i.dataset.disabled!==""),activeItem=items.find(item=>item.getAttribute("data-active")===""),highlightedItem=items.find(item=>item.getAttribute("data-highlighted")===""),currentItem=items.find(item=>item.id===currentTabStopId.value),candidateItems=[activeItem,highlightedItem,currentItem,...items].filter(Boolean);focusFirst(candidateItems,props.preventScrollOnEntryFocus)}}isClickFocus.value=!1}function handleMouseUp(){setTimeout(()=>{isClickFocus.value=!1},1)}return __expose({getItems}),provideRovingFocusGroupContext({loop,dir,orientation,currentTabStopId,onItemFocus:tabStopId=>{currentTabStopId.value=tabStopId},onItemShiftTab:()=>{isTabbingBackOut.value=!0},onFocusableItemAdd:()=>{focusableItemsCount.value++},onFocusableItemRemove:()=>{focusableItemsCount.value--}}),(_ctx,_cache)=>(openBlock(),createBlock(unref(CollectionSlot),null,{default:withCtx(()=>[createVNode(unref(Primitive),{tabindex:isTabbingBackOut.value||focusableItemsCount.value===0?-1:0,"data-orientation":unref(orientation),as:_ctx.as,"as-child":_ctx.asChild,dir:unref(dir),style:{outline:"none"},onMousedown:_cache[0]||(_cache[0]=$event=>isClickFocus.value=!0),onMouseup:handleMouseUp,onFocus:handleFocus,onBlur:_cache[1]||(_cache[1]=$event=>isTabbingBackOut.value=!1)},{default:withCtx(()=>[renderSlot(_ctx.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}}),RovingFocusGroup_default=RovingFocusGroup_vue_vue_type_script_setup_true_lang_default;export{RovingFocusGroup_default as R,focusFirst as f,getFocusIntent as g,injectRovingFocusGroupContext as i,wrapArray as w};
